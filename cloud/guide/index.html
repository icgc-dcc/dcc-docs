<!DOCTYPE html>
<html lang="en">


    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
         
        
        <link rel="canonical" href="http://docs.icgc.org/cloud/guide/">
        <link rel="shortcut icon" href="/img/favicon.ico">

   <title>Guide - ICGC DCC Docs</title>

        

        <link rel="prefetch" href="/fonts/fontello/font/icgc-icons.woff?93317606" />
        <link href="/fonts/fontello/css/icgc-icons.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,700,700italic' rel='stylesheet'
              type='text/css'>
        <link href="/css/bootstrap-custom.css" rel="stylesheet">
        <link href="/css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="/css/highlight.css">
        <link href="/fonts/fontello/css/animation.css" rel="stylesheet">
        <link href="/css/base.css" rel="stylesheet">
        <link href="/css/icgc-common.css" rel="stylesheet">



        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script src="/js/jquery-1.10.2.min.js"></script>
    </head>

    <body>
        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="background-container"></div>
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            
            <a class="navbar-brand" href="../..">
            
                <span class="project-org">ICGC</span> DCC Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="/../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Portal <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    
    <a href="../../portal/about/">About</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/access/">Access</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/analysis/">Analysis</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/api/">API</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/api-endpoints/">API Endpoints</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/methods/">Methods</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/projects/">Projects</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/publication/">Publication</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/releases/">Releases</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/repositories/">Repositories</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/search/">Search</a>
    
</li>

                    
                        
<li >
    
    <a href="../../portal/software/">Software</a>
    
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cloud <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    
    <a href="../about/">About</a>
    
</li>

                    
                        
<li class="active">
    
    <a href="./">Guide</a>
    
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Submission <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    
    <a href="../../submission/about/">About</a>
    
</li>

                    
                        
<li >
    
    <a href="../../submission/api/">API</a>
    
</li>

                    
                        
<li >
    
    <a href="../../submission/projects/">Projects</a>
    
</li>

                    
                        
<li >
    
    <a href="../../submission/institutions/">Institutions</a>
    
</li>

                    
                        
<li >
    
    <a href="../../submission/faq/">FAQ</a>
    
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Guide</a>
    <ul class="dropdown-menu">
        
            
<li >
    
    <a href="../../submission/guide/intro/">Introduction</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/overview/submitting-raw-data-ega/">Submitting Raw Data to EGA</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/overview/submission-file-format/">Submission File Format</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/overview/file-submission/">File Submission</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/overview/submission-validation/">Submission Validation</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/dcc-data-element-specifications/">DCC Data Element Specifications</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/icgc-simple-somatic-mutation-format/">Simple Somatic Mutation Format</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/clinical-data-submission-file-specifications/">Clinical Data Submission File Specifications</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/icgc-simple-somatic-mutation-format/">Simple Somatic Mutation Format</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/sample-type-specification/">Sample Type Specification</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/experimental-data-submission-file-specifications/">Experimental Data Submission File Specifications</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/donor-clinical-data-guidelines/">Donor Clinical Data Guidelines</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/mvel-script-restriction-example-cases/">MVEL Script Restriction Example Cases</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/incremental-submission-feature/">Incremental Submission Feature</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/guide/selective-validation-feature/">Selective Validation Feature</a>
    
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">PCAWG</a>
    <ul class="dropdown-menu">
        
            
<li >
    
    <a href="../../submission/pcawg/pancancer-clinical-data-requirements/">PanCancer Clinical Data Requirements</a>
    
</li>

        
            
<li >
    
    <a href="../../submission/pcawg/pcawg-faq/">FAQ</a>
    
</li>

        
    </ul>
  </li>

                    
                        
<li >
    
    <a href="../../submission/software/">Software</a>
    
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dictionary <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    
    <a href="../../dictionary/about/">About</a>
    
</li>

                    
                        
<li >
    
    <a href="../../dictionary/viewer/">Viewer</a>
    
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Release Notes</a>
    <ul class="dropdown-menu">
        
            
<li >
    
    <a href="../../dictionary/releases/">Overview</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-22/">Release 22</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-21/">Release 21</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-20/">Release 20</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-19/">Release 19</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-18/">Release 18</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-17/">Release 17</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-16/">Release 16</a>
    
</li>

        
            
<li >
    
    <a href="../../dictionary/release-15/">Release 15</a>
    
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    
    <a href="../../software/about/">About</a>
    
</li>

                    
                        
<li >
    
    <a href="../../software/releases/">Releases</a>
    
</li>

                    
                        
<li >
    
    <a href="../../software/binaries/">Binaries</a>
    
</li>

                    
                        
<li >
    
    <a href="../../software/code/">Source Code</a>
    
</li>

                    
                        
<li >
    
    <a href="../../software/development/">Development</a>
    
</li>

                    
                    </ul>
                </li>
            
            
                <li class="menu-bar"></li>
            </ul>

            <!-- Search -->
            <div class="searchbox-container col-sm-3 col-md-3">
               <form class="searchbox navbar-form" role="search">
                  <input id="mkdocs-search-query" type="search" placeholder="Search..." autocomplete="off" name="search" class="searchbox-input">
                  <span class="searchbox-icon">
                      <i class="icon-search search-bttn"></i>
                      <i class="icon-cancel search-cancel-bttn"></i>
                  </span>
               </form>
            </div>

            
        </div>
    </div>
</div>
        <div class="parent-container">

            <div id="docs-container" class="container">
                

<div id="mkdocs-search-results-container" class="row">
    <div class="col-md-12">
        <h1 id="dictionary-viewer" class="no-auto-render">
            <span class="header-badge" style="padding: 0.90rem 1.0rem 1.2rem 1.6rem;">
                <i class="icon-search"></i>
            </span> Search Results
        </h1>
        <div id="search-body">

        </div>
        <div id="mkdocs-search-results">

        </div>
    </div>
</div>
                <div id="body">
                
                <div class="col-md-3 toc-container"><div class="bs-sidebar hidden-print well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#cloud-guide">Cloud Guide</a>
           <ul class="nav">
           
               <li class=""><a href="#overview">Overview</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#process">Process</a></li>
                        
                        <li class=""><a href="#security">Security</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#authorization">Authorization</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#daco-cloud-access">DACO Cloud Access</a></li>
                        
                        <li class=""><a href="#access-tokens">Access Tokens</a></li>
                        
                        <li class=""><a href="#token-manager">Token Manager</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#compute-prerequisites">Compute Prerequisites</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#compute-instance">Compute Instance</a></li>
                        
                        <li class=""><a href="#resources">Resources</a></li>
                        
                        <li class=""><a href="#operating-system">Operating System</a></li>
                        
                        <li class=""><a href="#dependencies">Dependencies</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#installation">Installation</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#install-from-tarball">Install from Tarball</a></li>
                        
                        <li class=""><a href="#install-from-docker-image">Install from Docker Image</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#configuration">Configuration</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#access-configuration">Access Configuration</a></li>
                        
                        <li class=""><a href="#transport-configuration">Transport Configuration</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#file-search">File Search</a>
               
               </li>
           
               <li class=""><a href="#storage-client-usage">Storage Client Usage</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#help">Help</a></li>
                        
                        <li class=""><a href="#url-command">URL Command</a></li>
                        
                        <li class=""><a href="#download-command">Download Command</a></li>
                        
                        <li class=""><a href="#manifest-command">Manifest Command</a></li>
                        
                        <li class=""><a href="#view-command">View Command</a></li>
                        
                        <li class=""><a href="#mount-command">Mount Command</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#faqs">FAQs</a>
               
                    <ul class="nav">
                        
                        <li class=""><a href="#where-can-i-find-the-bundle-id-associated-with-an-object-id">Where can I find the Bundle ID associated with an Object ID?</a></li>
                        
                        <li class=""><a href="#where-are-detailed-storage-client-logs-stored">Where are detailed Storage Client logs stored?</a></li>
                        
                        <li class=""><a href="#how-long-will-pre-signed-urls-remain-valid">How long will pre-signed URLs remain valid?</a></li>
                        
                        <li class=""><a href="#does-the-client-maintain-state">Does the client maintain state?</a></li>
                        
                        <li class=""><a href="#why-do-i-get-a-security-exception-when-i-try-to-download-an-object">Why do I get a security exception when I try to download an object?</a></li>
                        
                        <li class=""><a href="#i-cant-use-the-result-of-a-url-command-with-samtools">I can’t use the result of a url command with samtools:</a></li>
                        
                        <li class=""><a href="#why-is-my-total-bytes-read-count-different-from-my-total-bytes-written">Why is my 'Total bytes read' count different from my 'Total bytes written'?</a></li>
                        
                        <li class=""><a href="#how-do-i-report-a-bug-in-the-software">How do I report a bug in the software?</a></li>
                        
                    </ul>
               
               </li>
           
               <li class=""><a href="#terms">Terms</a>
               
               </li>
           
           </ul>
       </li>
        </li>
    
    </ul>
</div></div>
                
                <div class="col-md-9 main-container" role="main">
                   

<h1 id="cloud-guide">Cloud Guide</h1>
<h2 id="overview">Overview</h2>
<p>This user guide describes the steps to securely explore and analyze ICGC data stored in <a href="https://aws.amazon.com/about-aws/">Amazon (<em>AWS</em>)</a> or <a href="http://www.cancercollaboratory.org/">Collaboratory (<em>OpenStack</em>)</a> cloud environments. For more information about ICGC cloud initiatives, please see <a href="https://dcc.icgc.org/icgc-in-the-cloud">ICGC in the Cloud</a>.</p>
<p>Please see <a href="#terms">Terms</a> for a glossary of terms used in this guide.</p>
<h3 id="process">Process</h3>
<p>The figure below illustrates the overall process and systems involved:</p>
<ol>
<li><a href="#authorization">Authorization</a>
    Apply for DACO <em>Cloud Access</em> if not already approved
    Upon approval, login to the <em>Data Portal</em>
    Generate an <em>Access Token</em> for cloud download</li>
<li><a href="#compute-prerequisites">Compute Prerequistes</a>
    Provision a <em>Compute Instance</em> in the target cloud</li>
<li><a href="#installation">Installation</a>
    Download and install the ICGC <em>Storage Client</em></li>
<li><a href="#configuration">Configuration</a>
    Configure the Storage Client to use the generated Access Token</li>
<li><a href="#file-search">File Search</a>
    Identify files of interest using the Data Portal</li>
<li><a href="#storage-client-usage">Storage Client Usage</a>
    Download or view data with the provided Storage Client or via an external tool</li>
</ol>
<p><a href="../images/process-diagram.png" title="Click Cloud Process Diagram to see the full image."><img alt="Cloud Process Diagram" src="../images/process-diagram.png" /></a></p>
<p>The subsequent sections will provide additional details on each of these topics.</p>
<h3 id="security">Security</h3>
<p>The usage of the distributed <a href="https://dcc.icgc.org/software">Storage Client</a> is required to provide additional security while operating in participating cloud environments and to enhance user download speeds.</p>
<h4 id="aws">AWS</h4>
<p>Security is enforced by a coordinating ICGC storage server. The client communicates with the server which brokers downloads and converts ICGC Access Tokens into Amazon <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/ShareObjectPreSignedURL.html">pre-signed urls</a>. Once a successful authorization handshake between the client and the server is established, downloads will be transferred directly from <em>S3</em> to the client, maintaining fast access to the data.</p>
<p>It is important to note that the provided software only functions within the <code>us-east-1</code> EC2 region of AWS located in Northern Virginia, U.S. where the data is physically stored. Attempting to use the software outside of this region will be denied data access.</p>
<h4 id="collaboratory">Collaboratory</h4>
<p>Downloads only function inside Collaboratory's OpenStack environment.</p>
<p>Lastly, it is the user’s responsibility to protect the data after it has been attained. This includes any subsequent analyses and storage on cloud and downstream resources.</p>
<h2 id="authorization">Authorization</h2>
<p>There are two prerequesites to using the Storage Client: DACO Cloud Access status and a self-provisioned Access Token.</p>
<h3 id="daco-cloud-access">DACO Cloud Access</h3>
<p>DACO Cloud Access is prerequisite to using the Storage Client. To apply for DACO access please follow the instructions provided at <a href="https://icgc.org/daco">https://icgc.org/daco</a>. Once approved, you will be able to <a href="https://dcc.icgc.org/">login</a> to the Data Portal to generate an <a href="#access-tokens">Access Token</a>. To login, click on the “Login” link in the upper right-hand corner of the page. When prompted, choose to login with either your <a href="https://icgc.org/user/login">ICGC.org login</a> or one of the supported OpenID providers (e.g. Google). After successful authentication, you will know that you have Cloud Access to the controlled tier if the “login” link is replaced with a green cloud icon ().</p>
<h3 id="access-tokens">Access Tokens</h3>
<p>The Access Token model used for protecting the cloud data set follows a similar process to Github’s <a href="https://help.github.com/articles/creating-an-access-token-for-command-line-use/">personal access tokens</a>. Tokens are used instead of a username / password to securely access ICGC resources.</p>
<p>Related to Access Tokens is the concept of <em>Scopes</em>. Tokens allow you to associate Scopes which limit access to that needed for the target environment. This enhances security by following the <a href="http://www.wikiwand.com/en/Principle_of_least_privilege">Principle of Least Privilege</a>. Cloud specific Scopes will become available after acquiring DACO Cloud Access. An instance of a cloud download token will grant access to all of the available data in that environment.</p>
<h3 id="token-manager">Token Manager</h3>
<p>To acquire an Access Token, you must first obtain DACO Clould Access and login to the Data Portal. After a successful login, there will be <em>Token Manager</em> link in the upper right corner of the page. Clicking on this link will display the Token Manager dialog:</p>
<p><a href="../images/token-manager-link.png" title="Click the Token Manager toolbar to see the full image."><img alt="Token Manager Link" src="../images/token-manager-link.png" /></a></p>
<p>From this dialog, you can manage the Access Tokens associated with your account. Importantly, you may delete and regenerate an access token if you believe that it has been compromised.</p>
<p><a href="../images/token-manager-screenshot.png" title="Click the Token &lt;anager screenshot to see the full image."><img alt="Token Manager Screenshot" src="../images/token-manager-screenshot.png" /></a></p>
<p>When creating an Access Token, you will need to specify the Scope associated with the target cloud(s).</p>
<h4 id="aws_1">AWS</h4>
<p>In the case of the ICGC AWS data set, an access token with the <span class="badge token-badge token-scopes">aws.download</span> scope is required to access the <a href="../../portal/access">controlled access data</a></p>
<h4 id="collaboratory_1">Collaboratory</h4>
<p>In the case of the ICGC Collaboratory data set, an access token with the <span class="badge token-badge token-scopes">collab.download</span> scope is required to access the <a href="../../portal/access">controlled access data</a></p>
<p>You can verify that your Access Token has the desired scopes by inspecting it in the table at the bottom of the dialog. For security purposes, Access Tokens must remain private and not be shared with anyone.</p>
<p>Following the creation of a Compute Instance, discussed in the next section, you will need to edit the Storage Client client configuration file to include the generated Access Token. See the <a href="#configuration">Configuration</a> section for additional information.</p>
<h2 id="compute-prerequisites">Compute Prerequisites</h2>
<h3 id="compute-instance">Compute Instance</h3>
<p>As a first step in analyzing data, you will need to create a Compute Instance to run the Storage Client and any other supporting software.</p>
<h4 id="aws_2">AWS</h4>
<p>In order to run within <a href="https://aws.amazon.com/ec2/">EC2</a>, you will need your own AWS account to provision a running EC2 instance. Any data processing will be charged to this account. Note that ICGC data download from S3 to the same EC2 region is free of charge. Please see Amazon's documentation for detailed instructions.</p>
<h4 id="collaboratory_2">Collaboratory</h4>
<p>In order to run within <a href="https://www.cancercollaboratory.org/">Collaboratory</a>, you will need to be enrolled. To begin the enrollment process, please send an email to <a href="mailto:help@cancercollaboratory.org">help@cancercollaboratory.org</a>.</p>
<p>The following sections provide guidance on selecting and configuring the chosen instance type.</p>
<h3 id="resources">Resources</h3>
<p>As data files are quite large, users should have enough local disk space to store files downloaded from the remote repository.</p>
<p>More processing cores will give greater parallelism, and therefore, better thoughput of downloads.</p>
<p>By default the storage client is configured to use a maximum of 3G of RAM. Most of time this is more than sufficient.</p>
<h3 id="operating-system">Operating System</h3>
<p>The Storage Client has been designed to work on modern Mac and Linux distributions. Windows should work as well but remains untested.</p>
<h3 id="dependencies">Dependencies</h3>
<p>The Storage Client requires Java 8 to be installed. It has been tested using the Oracle distribution. The procedure for installing Java 8 will vary depending on the operating system and package manager used.</p>
<p>In order to use the mount feature, <a href="http://fuse.sourceforge.net/">FUSE</a> is required. On most Linux based systems this will require installing <code>libfuse-dev</code> and <code>fuse</code> packages.</p>
<h2 id="installation">Installation</h2>
<p>This section describes how to install the Storage Client. The are two options: (a) from a tarball and (b) from a Docker image hosted on Dockerhub.</p>
<h3 id="install-from-tarball">Install from Tarball</h3>
<p>To begin using the Storage Client, the first step is to download the distribution. The latest version can be downloaded from <a href="https://dcc.icgc.org/software#storage-client">here</a>.</p>
<pre><code>wget -O icgc-storage-client.tar.gz https://dcc.icgc.org/api/v1/ui/software/icgc-storage-client/latest
tar -xvzf icgc-storage-client.tar.gz
</code></pre>

<p>After untaring the archive, the Storage Client will be available at <code>bin/icgc-storage-client</code>. Steps to verify the authenticity and integrity of the download can be found on our <a href="https://dcc.icgc.org/software">software</a> page.</p>
<h3 id="install-from-docker-image">Install from Docker Image</h3>
<p>We also support a Docker image of the Storage Client that is bundled with Java 8 for easy deployment.</p>
<p>The image is hosted at <a href="https://hub.docker.com/r/icgc/icgc-storage-client/">https://hub.docker.com/r/icgc/icgc-storage-client/</a> and downloaded by issuing the following command:</p>
<pre><code>docker pull icgc/icgc-storage-client
</code></pre>

<p>Once pulled, you can open a shell in the container by executing:</p>
<pre><code>docker run -it icgc/icgc-storage-client
</code></pre>

<p>There is no entry point or command defined for the image. The software may be located at <code>/icgc/icgc-storage-client</code> which is also the working directory of the container. All other steps for <a href="#storage-client-usage">using the Storage Client</a> will be the same for both Docker and tarball installations.</p>
<h2 id="configuration">Configuration</h2>
<p>The configuration of the Storage Client is stored in the <code>conf/application.properties</code> file of the distribution.</p>
<h3 id="access-configuration">Access Configuration</h3>
<p>The main configuration element is the access token generated in <a href="#access-tokens">Access Token</a> above. Configuration is stored in the <code>conf/</code> directory of the distribution.</p>
<p>Edit <code>application.properties</code> and add the generated accesss token to the line:</p>
<pre><code>accessToken=&lt;access token&gt;
</code></pre>

<p>When using Docker, this can also be set with an environmental variable:</p>
<pre><code>docker run -it -e ACCESSTOKEN=&lt;access token&gt; icgc/icgc-storage-client
</code></pre>

<h4 id="collaboratory_3">Collaboratory</h4>
<p>In addition to the above, you will need to change the <code>bin/icgc-storage-client</code> script to set <code>STORAGE_PROFILE=collab</code>. This can also performed externally via the environmental variable of the same name. Note that it is also possible to override this per execution using <code>bin/icgc-storage-client</code>'s <code>--profile collab</code> argument.</p>
<h3 id="transport-configuration">Transport Configuration</h3>
<p>Based on the target Compute Instance defined in <a href="#compute-prerequisites">Compute Prerequisites</a> and transfer speed requirements, it may be necessary to make changes to how the Storage Client transfers data. This is achieved by setting <code>transport.parallel</code> and <code>transport.memory</code>:</p>
<ul>
<li><code>transport.parallel</code> controls the number of concurrent threads for multi-part data transfers. It is recommended to set this to the number of cores of the Compute Instance.</li>
<li><code>transport.memory</code> is the amount of non-heap memory per thread, in gigabytes. It is recommended set this to a value of <code>1</code> (1 GB). Be sure to leave enough memory for the operating system and any other software that may be running on the Compute Instance.</li>
</ul>
<h2 id="file-search">File Search</h2>
<p>Finding files of interest can be done via the Data Portal. Objects are identified by their <em>Object ID</em>.</p>
<ul>
<li>Navigate to <a href="https://dcc.icgc.org/repositories">repository file search</a></li>
<li>Click on the <code>AWS</code> or <code>Collaboratory</code> filter in the left hand pane</li>
<li>Filter based on properties of interest (e.g. donor id, specimen id, etc.)</li>
<li>Export a <em>Manifest</em> for future use with the Storage Client</li>
</ul>
<p>The Manifest is the main way to define what files should be downloaded by the Storage Client. However, knowing the Object ID is sufficient for a single file download. To generate a Manifest, click on the "Download manifests" link the the Data Repository browser. You will be prompted with a "Download manifests" dialog:</p>
<p><a href="../images/download-manifest-dialog.png" title="Click the Download Manifest Dialog screenshot to see the full image."><img alt="Download Manifest Dialog" src="../images/download-manifest-dialog.png" /></a></p>
<p>Manifests downloaded from the Data Portal can be transferred to the Storage Client instance by using SFTP or SCP. For convenience, it is also possible to use a Manifest ID saved on the Data Portal by clicking on the "Manifest ID" button. See the <a href="#storage-client-usage">Storage Client Usage</a> section for usage information.</p>
<h2 id="storage-client-usage">Storage Client Usage</h2>
<p>This section provides information on how to use the Storage Client once it has been properly downloaded and configured. It assumes the user possesses and has configured the requisite access token discussed previously.</p>
<p>The Storage Client has the general syntax:</p>
<pre><code>icgc-storage-client [options] [command] [command options]
</code></pre>

<p>It offers a set of commands, where each command has its own set of options to influence its operation.</p>
<h3 id="help">Help</h3>
<p>The Storage Client provides a <code>--help</code> option to list the available commands and a brief description of their supported options:</p>
<pre><code>bin/icgc-storage-client --help
</code></pre>

<p>It is also possible to get information on a specific command using the <code>help</code> command:</p>
<pre><code>bin/icgc-storage-client help download
</code></pre>

<h3 id="url-command">URL Command</h3>
<p>The <code>url</code> command is the most basic command supported by the Storage Client. It allows one to resolve the underyling S3 URL for the requested object. This is useful if one wants to directly access the URL via HTTPS with an external client or tool (e.g. <code>curl</code>, <code>wget</code>, etc.)</p>
<pre><code>bin/icgc-storage-client url --object-id ddcdd044-adda-5f09-8849-27d6038f8ccd
</code></pre>

<p>An example of using <code>wget</code>:</p>
<pre><code class="bash">bin/icgc-storage-client url --object-id &lt;Object ID&gt;
Resolving URL for object: ddcdd044-adda-5f09-8849-27d6038f8ccd (offset = 0, length = -1)
https://s3-external-1.amazonaws.com/snip&gt;

wget https://s3-external-1.amazonaws.com/snip&gt;
</code></pre>

<h3 id="download-command">Download Command</h3>
<p>The <code>download</code> command allows fast parallel download of remote objects. It can be run in one of two modes: (a) single object mode and (b) Manifest driven mode</p>
<p>Note that the Storage Client is able to resume an interrupted download session. Simply rerun the same command again and it will continue.</p>
<h4 id="object-id">Object ID</h4>
<p>This mode is useful when downloading an ad-hoc list of one or more objects with known Object ID's, perhaps acquired from the Data Portal:</p>
<pre><code>bin/icgc-storage-client download --object-id ddcdd044-adda-5f09-8849-27d6038f8ccd --output-dir data
</code></pre>

<p>You can also specify multiple object id's separated by spaces</p>
<pre><code>bin/icgc-storage-client download --object-id ddcdd044-adda-5f09-8849-27d6038f8ccd 008da0c1-70cc-61ae-3bab-09aa17fad451 --output-dir data
</code></pre>

<p>Downloads will be stored in the <code>--output-dir</code>.</p>
<h4 id="manifest">Manifest</h4>
<p>Using a Manifest is ideal for downloading multiple files identified through the Data Portal. The <a href="https://dcc.icgc.org/repositories">repository file search</a> allows one to generate a Manifest file that can be supplied for bulk downloading files. It also provides some additional metadata for selected files that gives the donor, specimen and sample context.</p>
<pre><code>bin/icgc-storage-client download --manifest manifest.txt --output-dir data
</code></pre>

<p>The optional <code>--output-layout</code> option can be used to organize the downloads into a couple of predefined directory layouts. See the <code>--help</code> for addional information.</p>
<h3 id="manifest-command">Manifest Command</h3>
<p>The <code>manifest</code> command allows a user to quickly view the contents of a download Manifest produced by the Data Portal. A Manifest can come from:</p>
<ul>
<li>The local file system</li>
<li>A Manifest ID that is hosted on the Data Portal</li>
<li>Any URL</li>
</ul>
<p>A Manifest is a TSV file that contains both file identifying fields and satellite metadata for understanding the relationships to other data including donor, project and study.</p>
<h4 id="manifest-from-a-local-file">Manifest from a Local File</h4>
<p>An example of using a local file system Manifest:</p>
<pre><code>bin/icgc-storage-client manifest --manifest manifest.aws-virginia.1444232116728.txt
</code></pre>

<h4 id="manifest-from-the-data-portal">Manifest from the Data Portal</h4>
<p>An example of using a Data Portal hosted Manifest:</p>
<pre><code>bin/icgc-storage-client manifest --manifest 49e91614-7811-11e5-8a58-34363bcf803c
</code></pre>

<h4 id="manifest-from-a-url">Manifest from a URL</h4>
<p>An example of using a URL hosted Manifest:</p>
<pre><code>bin/icgc-storage-client manifest --manifest http://hastebin.com/raw/ujajodilih
</code></pre>

<h3 id="view-command">View Command</h3>
<p>The <code>view</code> command is a minimal version of <a href="http://www.htslib.org/doc/samtools.html">samtools view</a>. It allows one to request a “genomic slice” of the remote BAM file, freeing the user from having to download the entire file locally, saving bytes and time.</p>
<p>The following example will download reads overlapping the region 1 - 100000 in chromosome 1:</p>
<pre><code>bin/icgc-storage-client view --object-id ddcdd044-adda-5f09-8849-27d6038f8ccd --query 1:1-100000
</code></pre>

<p>The BAI is automatically discovered and streamed as part of the operation.</p>
<p>For quickly accessing only the BAM header one can issue:</p>
<pre><code>bin/icgc-storage-client view --header-only --object-id ddcdd044-adda-5f09-8849-27d6038f8ccd
</code></pre>

<p>It is also possible to pipe the output of the above to <code>samtools</code>, etc. for pipelining a workflow:</p>
<pre><code>bin/icgc-storage-client view --stdout --object-id ddcdd044-adda-5f09-8849-27d6038f8ccd | samtools mpileup -
</code></pre>

<h4 id="batchmanifest-slicing">Batch/Manifest Slicing</h4>
<p>As of version 1.0.14, the client supports slicing across "batches" of specimens listed in a manifest file (tab-delimited files produced by the Data Portal as opposed to XML-format manifests from GNOS). The output of this feature is illustrated here:</p>
<p><a href="../images/batch-slice-one-to-one.png"><img width=550 src="../images/batch-slice-one-to-one.png"></a></p>
<p>Multiple query regions can be specified at the command line, </p>
<pre><code>bin/icgc-storage-client view --manifest /data/manifest.txt --query 1:1245-1425 1:1578-1818 1:18100-19780 1:81011-81491 1:18100-19780 1:2772220-2772272 --output-dir /data/query-results
</code></pre>

<p>or in a <a href="https://genome.ucsc.edu/FAQ/FAQformat.html#format1">BED file</a></p>
<pre><code>bin/icgc-storage-client view --manifest /data/manifest.txt --bed-query /data/query/profile12.bed --output-dir /data/query-results
</code></pre>

<p>There is also a switch to have indexes generated for the output</p>
<pre><code>bin/icgc-storage-client view --manifest /data/manifest.txt <b>--output-index</b> --bed-query /data/query/profile12.bed --output-dir /data/query-results</code></pre>

<h3 id="mount-command">Mount Command</h3>
<p>The <code>mount</code> command can be used to mount the remote S3 bucket as a read-only <a href="http://fuse.sourceforge.net/">FUSE</a> file system. This is very useful to browse and explore the available files, as well as quickly see their size and date of modification using common commands such as <code>ls</code>, <code>find</code>, <code>du</code> and <code>tree</code>. It also works very well with standard analysis tools such as <code>samtools</code>.</p>
<p>Files are organized into a virtual directory structure. The following shows the default <code>bundle</code> layout:</p>
<pre><code>/bundleId1/fileName1
/bundleId1/fileName2
...
/bundleId1/fileNamei
...
/bundleIdn/fileName1
/bundleIdn/fileName2
...
/bundleIdn/fileNamej
</code></pre>

<p>where <code>bundleId</code> and <code>fileName</code> are the original <em>Bundle ID</em> and file name of the file respectively. It possible to control the layout using the <code>--layout</code> option. Using <code>--layout object-id</code> will instead produce a flat list of files named by their associated Object ID.</p>
<p>The file system implementation's performance is optimized for serial reads. Frequent random access patterns will lead to very poor performance. Under the covers, each random seek requires a new HTTP connection to S3 with the appropriate <code>Range</code> header set which is an expensive operation. For this reason, it is only recommended for streaming analysis (e.g. <code>samtools view</code> like functionality).</p>
<h4 id="mount-all-files">Mount All Files</h4>
<p>To mount all available files locally, issue the following:</p>
<pre><code># Create the mount point
mkdir /mnt/icgc

# Mount
bin/icgc-storage-client mount --mount-point /mnt/icgc
</code></pre>

<p>To speed up subsequent mounts, one can specify the <code>--cache-metadata</code> flag above which will locally store an index of the file system.</p>
<p>Once mounted, you can use standard analysis tools against files found under the mount point:</p>
<pre><code># Slice
samtools view /mnt/icgc/fff75930-0f8c-4c99-9b48-732e7ed4c625/443a7a6ab964e41c011cc9a303bc086c.bam 1:10000-20000
</code></pre>

<h4 id="mount-only-manifest-entries">Mount Only Manifest Entries</h4>
<p>To filter the mount to only include the files specified in a Manifest, issue the following:</p>
<pre><code># Create the mount point
mkdir /mnt/icgc

# Mount
bin/icgc-storage-client mount --mount-point /mnt/icgc --manfiest manifest&gt;
</code></pre>

<p>See the <code>manifest</code> command for more details on how to specify a Manifest.</p>
<h4 id="mount-in-docker">Mount in Docker</h4>
<p>To avoid having to install the FUSE and Java dependencies when working with the <code>mount</code> command, it is very convenient to mount from within a Docker container. This is also useful for creating a custom image for analysis that derives from the one published by ICGC. First, ensure that Docker and the Storage Client image is installed. See the <a href="#installation">Installation</a> section for details.</p>
<p>Next, export the access token generated from the portal:</p>
<pre><code># Export access token
export ACCESSTOKEN=accessToken&gt;
</code></pre>

<p>And then mount the file system inside the container against the empty <code>/mnt</code> directory:</p>
<pre><code># Alias for ease of use
alias icgc-storage-client=&quot;docker run -it --rm -e ACCESSTOKEN --privileged icgc/icgc-storage-client bin/icgc-storage-client&quot;
</code></pre>

<pre><code># Mount the file system in the container
icgc-storage-client mount --mount-point /mnt
</code></pre>

<p>Note that the <code>--privileged</code> Docker option is required for FUSE in order to access the host's <code>/dev/fuse</code> device.</p>
<p>In another terminal, you can access the newly mounted file system:</p>
<pre><code># List all files recursively
docker exec -it $(docker ps -lq) find /mnt
</code></pre>

<p>To perform analysis within the container:</p>
<pre><code># Open a shell in the previously created container
docker exec -it $(docker ps -lq) bash

# Install samtools
apt-get install samtools

# Slice
samtools view /mnt/fff75930-0f8c-4c99-9b48-732e7ed4c625/443a7a6ab964e41c011cc9a303bc086c.bam 1:10000-20000
</code></pre>

<p>Due to a limitation of Docker it is not possible to access a FUSE mounted file system from the host operating system. Please see <a href="https://github.com/docker/docker/issues/10088">here</a> for more details.</p>
<h2 id="faqs">FAQs</h2>
<h5 id="where-can-i-find-the-bundle-id-associated-with-an-object-id">Where can I find the Bundle ID associated with an Object ID?</h5>
<p>Currently the only way to retrieve the Bundle ID of an Object ID is by viewing the file entity page in the Data Portal. Navigate to the Data Repository browser and enter the Object ID in the "File" filter and click on the resulting record.</p>
<h5 id="where-are-detailed-storage-client-logs-stored">Where are detailed Storage Client logs stored?</h5>
<p>The Storage Client log file is stored at <code>logs/client.log</code></p>
<h5 id="how-long-will-pre-signed-urls-remain-valid">How long will pre-signed URLs remain valid?</h5>
<p>Pre-signed URLs are valid for 1 day from the time they are issued. For security purposes, a URL issued to one user must not be used by another and must be kept private.</p>
<h5 id="does-the-client-maintain-state">Does the client maintain state?</h5>
<p>Yes, the client maintains state, for <em>downloads</em>, in the working directory in a hidden file <code>.&lt;Object ID&gt;/meta</code>. This file includes cached pre-signed URLS. If your downloads fail unexpectedly, then try deleting this directory to purge pre-signed URLs that may have expired. Also, when using the <code>mount</code> command with the <code>--cache-metadata</code> option, <code>.entities.cache</code> and <code>.objects.cache</code> are stored in the current working directory.</p>
<h5 id="why-do-i-get-a-security-exception-when-i-try-to-download-an-object">Why do I get a security exception when I try to download an object?</h5>
<p>If you are targeting the AWS cloud, ensure that you are running within the <code>us-east-1</code> <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-regions-availability-zones">region</a>. If you are targeting Collaboratory, make sure you are inside the OpenStack environment.</p>
<h5 id="i-cant-use-the-result-of-a-url-command-with-samtools">I can’t use the result of a <code>url</code> command with <code>samtools</code>:</h5>
<p><code>samtools</code> doesn’t support the HTTPS protocol<span style="color: rgb(160, 58, 58);">*</span>, which is required by ICGC to access S3-stored data files. Use the client <code>view</code> command to pipe data to samtools, download the desired files locally, or use the mount command to create a FUSE mount of the ICGC data files.</p>
<p><span style="color: rgb(160, 58, 58);">*</span> <strong>Update</strong>: As of commit <a href="https://github.com/samtools/htslib/commit/fe1f08a3a80b8a5a17fa56b3fc1808ab2ac25d63">fe1f08a</a> <code>samtools</code> now supports file access over HTTPS and Amazon S3.</p>
<h5 id="why-is-my-total-bytes-read-count-different-from-my-total-bytes-written">Why is my 'Total bytes read' count different from my 'Total bytes written'?</h5>
<pre><code>./icgc/bin/icgc-storage-client --profile collab download --object-id 6d89e978-34f6-5074-b30e-01b7203fcbb3 --output-dir /tmp
Downloading...
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
100% [##################################################]  Parts: 208/208, Checksum: 100%, Write/sec: 47.7M/s, Read/sec: 48.1M/s
Finalizing...
Total execution time:         1.301 h

Total bytes read    : 225,224,593,891
Total bytes written : 223,331,450,672
</code></pre>

<p>Because of the size of BAM files, ICGC upload/downloads tend to be long-running, making them susceptible to any of the myriad ways a network can fail. ICGC attempts to recover from these usually-brief outages automatically and this often necessitates repeat downloads of sub-parts of the file. This will result in a "Total bytes read" amount larger than the "Total bytes written". The total byte counts are informational only and not used to determine "correctness" or "completeness" of any given download.</p>
<h5 id="how-do-i-report-a-bug-in-the-software">How do I report a bug in the software?</h5>
<p>Please contact <a href="mailto:dcc-support@icgc.org">dcc-support@icgc.org</a> and include the version of the software in the body of the message (<code>bin/icgc-storage-client --version</code>).</p>
<h2 id="terms">Terms</h2>
<p>Related terms and their defintions are given below:</p>
<table>
<thead>
<tr>
<th>Term</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Access Token</em></td>
<td>An authorization mechanism created by the <em>Data Portal</em> to access data.</td>
</tr>
<tr>
<td><em>Bundle ID</em></td>
<td>An identifier that refers to a submission bundle of related files. Typically the files produced by analysis workflows are packaged as a single unit. However, when a bundle is imported into a cloud repository each file in the bundle is given its own Object ID.</td>
</tr>
<tr>
<td><em>Compute Instance</em></td>
<td>A user virtual machine operating in a cloud environment.</td>
</tr>
<tr>
<td><em>DACO</em></td>
<td>The Data Access Compliance Office which handles requests from researchers for access to controlled data from the ICGC.</td>
</tr>
<tr>
<td><em>DACO Cloud Access</em></td>
<td>DACO access with supplemental approved Cloud Access status.</td>
</tr>
<tr>
<td><em>DCC</em></td>
<td>The ICGC Data Coordination Center (<a href="https://icgc.org/icgc/goals-structure-policies-guidelines/coordination">DCC</a>) performs quality assessment, curation and data releases and also manages the data flow from projects and centers to the central ICGC database and public repositories.</td>
</tr>
<tr>
<td><em>Data Portal</em></td>
<td>The ICGC data portal located at <a href="https://dcc.icgc.org">https://dcc.icgc.org</a>.</td>
</tr>
<tr>
<td><em>FUSE</em></td>
<td><a href="https://en.wikipedia.org/wiki/Filesystem_in_Userspace">Filesystem in Userspace</a> is an operating system mechanism for Unix-like computer operating systems that lets non-privileged users create their own file systems without editing kernel code.</td>
</tr>
<tr>
<td><em>Manifest</em></td>
<td>A file used as input to the Storage Client to describe and identify files to be downloaded.</td>
</tr>
<tr>
<td><em>Object ID</em></td>
<td>The unique identifier of an object expressed as a UUID. In the command line interface this is refered to as <code>--object-id</code>.</td>
</tr>
<tr>
<td><em>OpenStack</em></td>
<td>OpenStack is a cloud operating system that controls large pools of compute, storage, and networking resources throughout a datacenter, all managed through a dashboard that gives administrators control while empowering their users to provision resources through a web interface.</td>
</tr>
<tr>
<td><em>Scope</em></td>
<td>A user permission or authorization to access a resource.</td>
</tr>
<tr>
<td><em>Storage Client</em></td>
<td>Sofware provided by ICGC required to download data from AWS S3.</td>
</tr>
<tr>
<td><em>S3</em></td>
<td><a href="https://aws.amazon.com/s3/">Amazon Simple Storage Service</a>, the physical store of the ICGC AWS data.</td>
</tr>
<tr>
<td><em>Token Manager</em></td>
<td>Section of the portal used to manage Access Tokens.</td>
</tr>
</tbody>
</table>
               </div>
               </div>
            </div>

            <footer id="docs-footer">
                <div class="row">
                    <div class="col-md-12 logo">
                        <a href="http://oicr.on.ca/" target="_blank"><img src="../../img/OICR2logo.png"></a>
                    </div>
                </div>

                
                <div class="row">
                    <div class="col-md-12 footer-caption">
                        <small>
                            &copy; 2015-2016 <a href="https://icgc.org" target="_blank">International Cancer Genome Consortium.</a>
                            All Rights reserved.
                        </small>

                        
                        <small class="version-caption">
                            ICGC DCC Docs Version 1.0
                        </small>
                        
                    </div>
                </div>
                
            </footer>

            <script src="/js/jQuery-FontSpy.js"></script>
            <script src="/js/bootstrap-3.0.3.min.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script src="/js/lunr-0.5.7.min.js"></script>
            <script src="/js/jquery.highlight-4.closure.js"></script>
            <script src="/js/jquery.bootstrap-autohidingnavbar.min.js"></script>
            <script src="/js/jquery.scrollUp.min.js"></script>
            <script src="/js/icgc-common.js"></script>
            <script>var base_url = '../..';</script>
        </div>
    </body>
</html>